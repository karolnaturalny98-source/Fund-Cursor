# Podsumowanie architektury
- Routing korzysta z Next.js App Router i dzieli się na landing `/`, dedykowane podstrony (`/firmy`, `/rankingi`, `/opinie`, `/analizy`, `/affilacja`, `/sklep`, `/baza-wiedzy`, `/o-nas`), panel użytkownika (`/panel`) oraz sekcję admina (`/admin/(tabs)/*`). Każda strona marketingowa ręcznie dodaje tło `AuroraWrapper`, przez co efekt WebGL jest duplikowany.
- Globalny layout (`app/layout.tsx`) składa się z `ClerkProvider`, `ThemeProvider`, `CurrencyProvider`, `UserPanelProvider`, `SiteHeader`, `SiteFooter`, `UserPanel` i `Toaster`. Dodatkowe layouty istnieją tylko w adminie (`app/admin/layout.tsx` + `app/admin/(tabs)/layout.tsx`).
- Kluczowe komponenty to: system porównań (`CompareProvider`, `CompareBar`), duży zestaw modułów firmowych (`CompanyHeroClient`, `PlansShopList`, `Payouts*`, `ReviewsPanel`, `CompanyFaqTabs`, `CompanyMedia`, `TeamHistoryTabsCard`), komponenty rankingowo-analityczne (`RankingsPageClient`, `RankingsExplorer`, `AnalysisLayout`), moduły społeczności (`ReviewsRankingPage`, `OpiniePageClient`, `ReviewForm`), sekcje CTA (szereg komponentów w `components/home/*` i `components/affiliate/*`) oraz ogromna biblioteka admin (`components/admin/*`).
- Panel użytkownika istnieje w dwóch formach: jako globalny `UserPanel` (wysuwany drawer) oraz pełna strona `/panel`, przy czym oba zużywają te same endpointy i komponenty (`UserDashboardQuickStats`, `RedeemSection`, `DisputesSection`, `FavoritesSection`), co powoduje podwójną złożoność.

# Podsumowanie stylów
- Jedyny styl globalny (`app/globals.css`) implementuje Tailwind 4 poprzez `@utility`/`@theme`. Zdefiniowano w nim zestaw `fluid-*` (typografia i spacing), `glass-*`, gradienty, cienie i klasy `border-*`. Nie istnieje `tailwind.config.*`, więc wszystkie tokeny i warianty żyją w CSS.
- shadcn/ui (`components/ui/*`) jest podstawowym źródłem komponentów. Każdy komponent wstrzykuje `fluid` utilsy, gradienty i niestandardowe warianty (np. `Button` z `premium`, `premium-outline`, `glow`).
- Brak CSS Modules i dodatkowych arkuszy: wszystkie widoki wykorzystują inline klasy Tailwinda + custom utilsy. Marketingowe strony powielają identyczne bloki kontenera z `fluid-stack-*` i `backdrop-blur-[36px]!`.
- W katalogu `components/layout` `SiteHeader` i `SiteFooter` używają klasy `glass-premium`, która nie jest zdefiniowana w `globals.css`, więc planowany efekt nie istnieje.

# Podsumowanie API/danych
- Prisma schema obejmuje kilkanaście modeli (User, Company, CompanyPlan, CashbackTransaction, AffiliateTransaction, Favorite, ClickEvent, Review, InfluencerProfile, DataIssueReport, DisputeCase, TeamMember, CompanyTimeline, CompanyCertification, CompanyMedia, CompanyRankingHistory, BlogPost, MarketingSpotlight, NewsletterSubscriber).
- `lib/queries/*` zawiera serwerowe fetchery (część owinięta w `unstable_cache` z revalidate 5–10 min). Kluczowe funkcje: `getCompanyBySlug`, `getCompanies`, `getHomeRanking`, `getRankingsDataset`, `getShopRevenueStats`, `getAffiliateQueue`, `getRedeemQueue`, `getInfluencerProfiles`, `getPendingReviews`.
- API w `app/api/*` dzieli się na open/public (kliknięcia, newsletter, rankingi, currency), user (`/api/user/*`, `/api/wallet/*`, `/api/cashback`, `/api/shop/*`, `/api/influencers/profile`, `/api/companies/[slug]/reviews`) i admin (`/api/admin/*`). Większość admin endpointów korzysta z `assertAdminRequest`, ale `/api/admin/newsletter` jest wyjątkiem.
- Główne przepływy: strona główna pobiera metryki, ranking i sekcje marketingowe; strona firmy ładuje komplet szczegółów + podobne firmy; `CompareProvider` współdzieli slug-i w query param; CurrencyProvider steruje walutą i kursami; CTA i zakupy przechodzą przez `/api/clicks` + `/api/shop/purchase`; cashback/wallet operuje na `CashbackTransaction` i `AffiliateTransaction`.

# TOP 10 problemów
1. **P1** – `/api/cashback/route.ts` pozwala każdemu zalogowanemu użytkownikowi utworzyć dowolną transakcję cashbackową (wraz ze statusem `APPROVED` lub dodatnimi punktami), co umożliwia samodzielne dopisywanie nagród (`app/api/cashback/route.ts`).
2. **P1** – `/api/admin/newsletter/route.ts` oraz `/api/admin/newsletter/[id]/route.ts` sprawdzają jedynie `userId` (TODO w komentarzu), więc każdy zalogowany użytkownik może pobrać, edytować lub usunąć subskrybentów (`app/api/admin/newsletter/route.ts`, `app/api/admin/newsletter/[id]/route.ts`).
3. **P2** – Panel newslettera admina (`app/admin/(tabs)/newsletter/page.tsx`) działa w 100% po stronie klienta, odświeża dane w pętli i korzysta z niezabezpieczonego endpointu. W efekcie subskrybenci i statystyki są ujawnieni również użytkownikom nie-admin, gdy tylko dotrą do tego URL-a.
4. **P2** – Strona firmy (`app/firmy/[slug]/page.tsx`) to ogromny komponent serwerowy ładujący wszystkie relacje (plany, recenzje, timeline, certyfikaty, media, ranking history) jednorazowo. Powoduje wysokie TTFB i utrudnia iteracje/refaktor.
5. **P2** – `AuroraWrapper` i jego otaczający markup są ręcznie powielane na niemal każdej stronie (`app/page.tsx`, `app/firmy/page.tsx`, `app/opinie/page.tsx`, `app/analizy/page.tsx`, `app/affilacja/page.tsx`, `app/o-nas/page.tsx`). Efekt WebGL jest inicjalizowany wielokrotnie, nie istnieje wspólny layout ani kontrola wydajności.
6. **P2** – `app/panel/page.tsx` i globalny `UserPanel` (renderowany w `app/layout.tsx`) realizują te same widoki (overview/redeem/disputes/favorites/influencer), ale pracują niezależnie. Oba komponenty wykonują te same fetch’e `/api/user/summary`, `/api/wallet/offers`, `/api/user/disputes`, co zwiększa liczbę żądań i komplikuje UI.
7. **P2** – `SiteHeader` i `SiteFooter` używają nieistniejącej klasy `glass-premium`, więc sticky header oraz mobilne menu tracą zamierzony efekt szklanego panelu (`components/layout/site-header.tsx`, `components/layout/site-footer.tsx` vs `app/globals.css`).
8. **P2** – `app/admin/(tabs)/newsletter/page.tsx` wykonuje częste odświeżenia (debounce 300 ms) i brak paginacji SSR – przy dużej liczbie rekordów komponent w całości renderuje się po stronie klienta, co pogarsza UX i obciąża przeglądarkę.
9. **P3** – Brak pliku `tailwind.config.*` wymusza utrzymywanie wszystkich tokenów w `globals.css`, co utrudnia współdzielenie stylów między komponentami, testy i dokumentację (nie można korzystać z automatycznych narzędzi Tailwinda).
10. **P3** – `Section` komponent nie jest konsekwentnie używany; wiele stron (np. `app/rankingi/page.tsx`) miesza `Section`, `container` i własne `px-[clamp(...)]`, przez co layouty mają różne odstępy i ciężko będzie zbudować spójny „one-page core”.

# Sugestie działań (kolejne etapy)
1. **Nowa strona główna / one-page core** – zunifikować marketingowe sekcje (Hero, ranking, top cashback, społeczność, CTA) w jednym komponencie/layaoucie, wykorzystując `Section` i wspólne tło, zamiast ręcznych `AuroraWrapper` na każdej stronie.
2. **Uproszczenie routingów** – wydzielić logiczne layouty (np. `marketing-layout` z aurorą, `commerce-layout` dla `/firmy/*`), skonsolidować `UserPanel` i `/panel`, ograniczyć liczbę SSR fetch’y w `app/firmy/[slug]`.
3. **Uporządkowanie stylów** – przenieść tokeny do `tailwind.config.ts`, zdefiniować klasy typu `glass-premium`, ujednolicić spacing przez `Section` i `fluid` utilsy, usunąć duplikaty gradientów, zmapować warianty do komponentów shadcn.
4. **Standardy komponentów** – rozbić `CompanyPage` na moduły, stworzyć pojedynczy `AuroraLayout`, wydzielić powtarzalne karty/sekcje (rankingi, CTA, listy). Ograniczyć inline `clamp` i `!important` w komponentach.
5. **Usprawnienie API** – zabezpieczyć `/api/cashback` i `/api/admin/newsletter` (`assertAdminRequest`), dodać rate limiting do newslettera/kliknięć, zredukować liczbę równoległych zapytań (np. paginacja recenzji), zapewnić rewalidację dla wszystkich mutacji i wprowadzić osobne endpointy dla panelu i overlay’a.
